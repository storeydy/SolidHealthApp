{"id":"node_modules/@inrupt/solid-client-authn-core/dist/authenticatedFetch/dpopUtils.js","dependencies":[{"name":"C:\\Users\\store\\Documents\\College\\5th Year\\MAI Project\\storeydy.github.io\\node_modules\\@inrupt\\solid-client-authn-core\\dist\\authenticatedFetch\\dpopUtils.js.map","includedInParent":true,"mtime":1645788390982},{"name":"C:\\Users\\store\\Documents\\College\\5th Year\\MAI Project\\storeydy.github.io\\node_modules\\@inrupt\\solid-client-authn-core\\src\\authenticatedFetch\\dpopUtils.ts","includedInParent":true,"mtime":1645788391036},{"name":"C:\\Users\\store\\Documents\\College\\5th Year\\MAI Project\\storeydy.github.io\\package.json","includedInParent":true,"mtime":1645793376876},{"name":"C:\\Users\\store\\Documents\\College\\5th Year\\MAI Project\\storeydy.github.io\\node_modules\\@inrupt\\solid-client-authn-core\\package.json","includedInParent":true,"mtime":1645788391034},{"name":"@inrupt/jose-legacy-modules","loc":{"line":4,"column":38},"parent":"C:\\Users\\store\\Documents\\College\\5th Year\\MAI Project\\storeydy.github.io\\node_modules\\@inrupt\\solid-client-authn-core\\dist\\authenticatedFetch\\dpopUtils.js","resolved":"C:\\Users\\store\\Documents\\College\\5th Year\\MAI Project\\storeydy.github.io\\node_modules\\@inrupt\\jose-legacy-modules\\dist\\index.browser.js"},{"name":"uuid","loc":{"line":5,"column":23},"parent":"C:\\Users\\store\\Documents\\College\\5th Year\\MAI Project\\storeydy.github.io\\node_modules\\@inrupt\\solid-client-authn-core\\dist\\authenticatedFetch\\dpopUtils.js","resolved":"C:\\Users\\store\\Documents\\College\\5th Year\\MAI Project\\storeydy.github.io\\node_modules\\uuid\\dist\\esm-browser\\index.js"},{"name":"../constant","loc":{"line":6,"column":27},"parent":"C:\\Users\\store\\Documents\\College\\5th Year\\MAI Project\\storeydy.github.io\\node_modules\\@inrupt\\solid-client-authn-core\\dist\\authenticatedFetch\\dpopUtils.js","resolved":"C:\\Users\\store\\Documents\\College\\5th Year\\MAI Project\\storeydy.github.io\\node_modules\\@inrupt\\solid-client-authn-core\\dist\\constant.js"}],"generated":{"js":"\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.generateDpopKeyPair = exports.createDpopHeader = void 0;\r\nconst jose_legacy_modules_1 = require(\"@inrupt/jose-legacy-modules\");\r\nconst uuid_1 = require(\"uuid\");\r\nconst constant_1 = require(\"../constant\");\r\nfunction removeHashUsernameAndPassword(audience) {\r\n    const cleanedAudience = new URL(audience);\r\n    cleanedAudience.hash = \"\";\r\n    cleanedAudience.username = \"\";\r\n    cleanedAudience.password = \"\";\r\n    return cleanedAudience.toString();\r\n}\r\nasync function createDpopHeader(audience, method, dpopKey) {\r\n    return new jose_legacy_modules_1.SignJWT({\r\n        htu: removeHashUsernameAndPassword(audience),\r\n        htm: method.toUpperCase(),\r\n        jti: uuid_1.v4(),\r\n    })\r\n        .setProtectedHeader({\r\n        alg: constant_1.PREFERRED_SIGNING_ALG[0],\r\n        jwk: dpopKey.publicKey,\r\n        typ: \"dpop+jwt\",\r\n    })\r\n        .setIssuedAt()\r\n        .sign(dpopKey.privateKey, {});\r\n}\r\nexports.createDpopHeader = createDpopHeader;\r\nasync function generateDpopKeyPair() {\r\n    const { privateKey, publicKey } = await jose_legacy_modules_1.generateKeyPair(constant_1.PREFERRED_SIGNING_ALG[0]);\r\n    const dpopKeyPair = {\r\n        privateKey,\r\n        publicKey: await jose_legacy_modules_1.fromKeyLike(publicKey),\r\n    };\r\n    [dpopKeyPair.publicKey.alg] = constant_1.PREFERRED_SIGNING_ALG;\r\n    return dpopKeyPair;\r\n}\r\nexports.generateDpopKeyPair = generateDpopKeyPair;\r\n"},"sourceMaps":{"js":{"version":3,"file":"dpopUtils.js","sourceRoot":"","sources":["../../src/authenticatedFetch/dpopUtils.ts"],"names":[],"mappings":";;;AAqBA,qEAMqC;AACrC,+BAA0B;AAC1B,0CAAoD;AASpD,SAAS,6BAA6B,CAAC,QAAgB;IACrD,MAAM,eAAe,GAAG,IAAI,GAAG,CAAC,QAAQ,CAAC,CAAC;IAC1C,eAAe,CAAC,IAAI,GAAG,EAAE,CAAC;IAC1B,eAAe,CAAC,QAAQ,GAAG,EAAE,CAAC;IAC9B,eAAe,CAAC,QAAQ,GAAG,EAAE,CAAC;IAC9B,OAAO,eAAe,CAAC,QAAQ,EAAE,CAAC;AACpC,CAAC;AAgBM,KAAK,UAAU,gBAAgB,CACpC,QAAgB,EAChB,MAAc,EACd,OAAgB;IAEhB,OAAO,IAAI,6BAAO,CAAC;QACjB,GAAG,EAAE,6BAA6B,CAAC,QAAQ,CAAC;QAC5C,GAAG,EAAE,MAAM,CAAC,WAAW,EAAE;QACzB,GAAG,EAAE,SAAE,EAAE;KACV,CAAC;SACC,kBAAkB,CAAC;QAClB,GAAG,EAAE,gCAAqB,CAAC,CAAC,CAAC;QAC7B,GAAG,EAAE,OAAO,CAAC,SAAS;QACtB,GAAG,EAAE,UAAU;KAChB,CAAC;SACD,WAAW,EAAE;SACb,IAAI,CAAC,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC;AAClC,CAAC;AAjBD,4CAiBC;AAEM,KAAK,UAAU,mBAAmB;IACvC,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,GAAG,MAAM,qCAAe,CACrD,gCAAqB,CAAC,CAAC,CAAC,CACzB,CAAC;IACF,MAAM,WAAW,GAAG;QAClB,UAAU;QACV,SAAS,EAAE,MAAM,iCAAW,CAAC,SAAS,CAAC;KACxC,CAAC;IAEF,CAAC,WAAW,CAAC,SAAS,CAAC,GAAG,CAAC,GAAG,gCAAqB,CAAC;IACpD,OAAO,WAAW,CAAC;AACrB,CAAC;AAXD,kDAWC","sourcesContent":["/*\r\n * Copyright 2021 Inrupt Inc.\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal in\r\n * the Software without restriction, including without limitation the rights to use,\r\n * copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the\r\n * Software, and to permit persons to whom the Software is furnished to do so,\r\n * subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in\r\n * all copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\r\n * INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\r\n * PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\r\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\r\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\r\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n */\r\n\r\nimport {\r\n  JWK,\r\n  KeyLike,\r\n  SignJWT,\r\n  generateKeyPair,\r\n  fromKeyLike,\r\n} from \"@inrupt/jose-legacy-modules\";\r\nimport { v4 } from \"uuid\";\r\nimport { PREFERRED_SIGNING_ALG } from \"../constant\";\r\n\r\n/**\r\n * Normalizes a URL in order to generate the DPoP token based on a consistent scheme.\r\n *\r\n * @param audience The URL to normalize.\r\n * @returns The normalized URL as a string.\r\n * @hidden\r\n */\r\nfunction removeHashUsernameAndPassword(audience: string): string {\r\n  const cleanedAudience = new URL(audience);\r\n  cleanedAudience.hash = \"\";\r\n  cleanedAudience.username = \"\";\r\n  cleanedAudience.password = \"\";\r\n  return cleanedAudience.toString();\r\n}\r\n\r\nexport type KeyPair = {\r\n  privateKey: KeyLike;\r\n  publicKey: JWK;\r\n};\r\n\r\n/**\r\n * Creates a DPoP header according to https://tools.ietf.org/html/draft-fett-oauth-dpop-04,\r\n * based on the target URL and method, using the provided key.\r\n *\r\n * @param audience Target URL.\r\n * @param method HTTP method allowed.\r\n * @param key Key used to sign the token.\r\n * @returns A JWT that can be used as a DPoP Authorization header.\r\n */\r\nexport async function createDpopHeader(\r\n  audience: string,\r\n  method: string,\r\n  dpopKey: KeyPair\r\n): Promise<string> {\r\n  return new SignJWT({\r\n    htu: removeHashUsernameAndPassword(audience),\r\n    htm: method.toUpperCase(),\r\n    jti: v4(),\r\n  })\r\n    .setProtectedHeader({\r\n      alg: PREFERRED_SIGNING_ALG[0],\r\n      jwk: dpopKey.publicKey,\r\n      typ: \"dpop+jwt\",\r\n    })\r\n    .setIssuedAt()\r\n    .sign(dpopKey.privateKey, {});\r\n}\r\n\r\nexport async function generateDpopKeyPair(): Promise<KeyPair> {\r\n  const { privateKey, publicKey } = await generateKeyPair(\r\n    PREFERRED_SIGNING_ALG[0]\r\n  );\r\n  const dpopKeyPair = {\r\n    privateKey,\r\n    publicKey: await fromKeyLike(publicKey),\r\n  };\r\n  // The alg property isn't set by fromKeyLike, so set it manually.\r\n  [dpopKeyPair.publicKey.alg] = PREFERRED_SIGNING_ALG;\r\n  return dpopKeyPair;\r\n}\r\n"]}},"error":null,"hash":"2d7e648daa1def23d767a04e62981eb1","cacheData":{"env":{}}}